# yaml-language-server: $schema=https://raw.githubusercontent.com/bibendi/dip/refs/heads/master/schema.json
#
# Example: Modular Dip Configuration with Modules
# Use Case: Large projects with shared configurations across teams
# Features: Module system for reusable command sets
#
# This example demonstrates how to split your dip configuration into modules.
# Modules allow you to:
# - Share common commands across multiple projects
# - Organize large configurations
# - Enable/disable feature sets easily
# - Maintain team-specific tooling separately
#
# Usage:
#   dip rails console          # From main config
#   dip rubocop                # From sast module
#   dip rspec                  # From testing module
#
# Learn more: https://github.com/bibendi/dip

version: '8.2.8'

environment:
  RAILS_ENV: development

compose:
  files:
    - docker-compose.yml

# Import modules from .dip/ directory
modules:
  - sast      # Static analysis security testing tools
  - testing   # Testing frameworks and tools

# Main application commands
interaction:
  shell:
    description: Start a shell in the web container
    service: web
    command: /bin/bash

  rails:
    description: Run Rails commands
    service: web
    command: bundle exec rails
    subcommands:
      console:
        description: Start Rails console
        command: console
      server:
        description: Start Rails server
        command: server -b 0.0.0.0

  bundle:
    description: Run bundle commands
    service: web
    command: bundle

provision:
  default:
    - dip compose up -d db
    - dip bundle install
    - dip rails db:create db:migrate db:seed
