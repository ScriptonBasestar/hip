# yaml-language-server: $schema=https://raw.githubusercontent.com/ScriptonBasestar/hip/refs/heads/master/schema.json
#
# Example: Multi-Environment with env_file
# Use Case: Support development, staging, production environments
# Features: Environment-specific .env files, variable interpolation
#
# Usage:
#   # Development (default)
#   hip rails server
#
#   # Staging
#   ENV=staging hip rails server
#
#   # Production
#   ENV=production hip rails server
#
# Learn more: https://github.com/ScriptonBasestar/hip

version: '9.0.0'

# Load environment-specific .env file
# Uses $ENV variable (defaults to "development")
env_file:
  - .env.${ENV:-development}
  - .env.local  # Local overrides (always loaded)

environment:
  NODE_ENV: ${ENV:-development}
  RAILS_ENV: ${ENV:-development}
  APP_NAME: myapp

compose:
  files:
    - docker-compose.yml
    - docker-compose.${ENV:-development}.yml

interaction:
  rails:
    description: Run Rails commands
    service: web
    command: bundle exec rails
    subcommands:
      server:
        description: Start Rails server
        command: server -b 0.0.0.0

  console:
    description: Open Rails console
    service: web
    command: bundle exec rails console

  shell:
    description: Open bash shell
    service: web
    command: bash

provision:
  default:
    - hip rails db:create
    - hip rails db:migrate

# Example file structure:
# ---------------------------------------------------
# .env.development (committed - dev defaults)
# API_URL=http://localhost:3000
# LOG_LEVEL=debug
# ENABLE_CACHE=false
# DATABASE_HOST=postgres
# DATABASE_PORT=5432
# DATABASE_NAME=myapp_development
#
# .env.staging (committed - staging config)
# API_URL=https://staging.example.com
# LOG_LEVEL=info
# ENABLE_CACHE=true
# DATABASE_HOST=staging-db.example.com
# DATABASE_PORT=5432
# DATABASE_NAME=myapp_staging
#
# .env.production (committed - production config, no secrets!)
# API_URL=https://api.example.com
# LOG_LEVEL=warn
# ENABLE_CACHE=true
# DATABASE_HOST=prod-db.example.com
# DATABASE_PORT=5432
# DATABASE_NAME=myapp_production
#
# .env.local (git-ignored - secrets and local overrides)
# # Development secrets
# DATABASE_PASSWORD=dev_password
# SECRET_KEY_BASE=dev_secret_key
#
# # Or staging secrets (when ENV=staging)
# DATABASE_PASSWORD=staging_password
# SECRET_KEY_BASE=staging_secret_key
# ---------------------------------------------------
#
# Variable interpolation example:
# In .env file:
#   DATABASE_URL=postgres://${DATABASE_USER}:${DATABASE_PASSWORD}@${DATABASE_HOST}:${DATABASE_PORT}/${DATABASE_NAME}
#
# .gitignore:
#   .env.local
#   .env.*.local
#
# Usage examples:
#   hip rails console                    # Development
#   ENV=staging hip rails console        # Staging
#   ENV=production hip rails console     # Production
#   LOG_LEVEL=debug hip rails server     # Override LOG_LEVEL
