# yaml-language-server: $schema=https://raw.githubusercontent.com/bibendi/dip/refs/heads/master/schema.json
#
# Example: Basic Hip Configuration for Rails
# Use Case: Simple Rails project with PostgreSQL - perfect for getting started
# Features: Essential commands (shell, rails, bundle, rake), simple provision
#
# Usage:
#   hip provision          # Set up the project for the first time
#   dip shell              # Start a bash shell in the container
#   dip rails console      # Start Rails console
#   dip rake db:migrate    # Run database migrations
#   dip bundle install     # Install gems
#
# Learn more: https://github.com/bibendi/dip

version: '8.2.8'

# Environment variables available to all services
environment:
  RAILS_ENV: development
  DATABASE_URL: postgres://user:password@db:5432/myapp_development

# Docker Compose configuration
compose:
  files:
    - docker-compose.yml

# Interactive commands
interaction:
  # Start a bash shell
  shell:
    description: Start a shell in the web container
    service: web
    command: /bin/bash

  # Rails commands
  rails:
    description: Run Rails commands
    service: web
    command: bundle exec rails
    compose:
      run_options:
        - rm  # Remove container after exit

  # Bundle commands
  bundle:
    description: Run bundle commands
    service: web
    command: bundle

  # Rake tasks
  rake:
    description: Run Rake tasks
    service: web
    command: bundle exec rake

  # Database console
  psql:
    description: Connect to PostgreSQL database
    service: db
    command: psql -h db -U user myapp_development
    environment:
      PGPASSWORD: password

# Provision scripts for project setup
provision:
  # Default setup - run this for first-time setup
  default:
    - hip compose down --volumes
    - hip compose up -d db
    - dip bundle install
    - dip rails db:create
    - dip rails db:migrate
    - dip rails db:seed
