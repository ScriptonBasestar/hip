# yaml-language-server: $schema=./schema.json

version: '9.2.0'

compose:
  files:
    - docker-compose.yml

interaction:
  shell:
    description: Open the Bash shell in app's container
    service: app
    command: /bin/bash

  pry:
    description: Open Pry console
    service: app
    command: ./bin/console

  bundle:
    description: Run Bundler commands
    service: app
    command: bundle

  rspec:
    description: Run Rspec commands
    service: app
    command: bundle exec rspec

  rubocop:
    description: Run Rubocop commands
    service: app
    command: bundle exec rubocop

  bash:
    description: Open the Bash - root user
    workdir: /app
#    user: root:root
    user: "33:33"
    # user: 33:33
    service: app
    command: /bin/bash -c

  bash2:
    description: Open the Bash - root user
    user: "1000:1000"
    service: app
    command: /bin/bash -c

provision:
  # Note: Containers will auto-start if needed (since v9.1.3)
  default:
    - step: Preparing development environment
      run:
        - cp -f lefthook-local.dip_example.yml lefthook-local.yml
        - rm -rf Gemfile.lock

    - step: Installing dependencies
      run: hip bundle install

    - step: Setup complete
      note: |
        ✅ Hip development environment ready!

        Available commands:
          hip shell      - Open Bash shell in app container
          hip rspec      - Run RSpec tests
          hip rubocop    - Run RuboCop linter

  # Reset profile includes container management for full cleanup
  reset:
    - step: Stopping containers and removing volumes
      run: hip compose down --volumes

    - step: Starting fresh containers
      run: hip compose up -d

    - step: Reinstalling dependencies
      run:
        - rm -rf Gemfile.lock
        - hip bundle install

    - step: Reset complete
      note: |
        ✅ Environment reset!
        All containers rebuilt and dependencies reinstalled.

  # Legacy format example (for testing backward compatibility)
  legacy_format:
    - "echo 'This is the legacy string format'"
    - "rm -rf Gemfile.lock"
    - "hip bundle install"
